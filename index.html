<!DOCTYPE html>
<html>
	<head>
		<meta charset='UTF-8'>
		<!--<script src='./jquery-3.2.0.min.js'></script>
		<script src='./functions.js'></script>-->
		<script src='./marked.min.js'></script>
		<script src='./vue.min.js'></script>
		<link href='./style.css' rel='stylesheet'>
		<title id="title">{{(title?title+" - ":"")+Default}}</title>
		<script>/*
			var ArticleIDs=[],Titles=[],PublishTimes=[],PreArticles=[],ViewTimes=[];
			const MaxAriclePerPage=10;
			const PHP="./page.php?";
			const site='127.0.0.1/Website/';
			const menus=[
				[site,'Home'],
				['./online_chat.php','Online Chat'],
				['./disc.html','About']
			];
			const loading='';
			var lsb;
			$(window).scroll(function(){
				lsb.animate({
					top:$(window).scrollTop()+"px"
				},50);
			});
			$(document).ready(function(){
				const MAX_ARTICLE_PER_PAGE=10;
				var main=$("#main");
				lsb=$("#leftsidebar");
				var cURL=window.location.toString();
				var currentPAGE=1;
				
				function changeToArticle(id){
					lsb.toggle();
					var article,title,id,viewtimes,pubdate,pubtime;
					$.get(PHP+"aid="+id,function(data){
						if(data){
							data=eval(data)[0];
							article=data.article,id=data.id,title=data.title;
							//console.log(title);
							window.history.pushState({},0,'#article/'+id+"/"+title+'.html');
							viewtimes=data.viewtimes;
							pubdata=data.pubdata;
							pubtime=data.pubtime;
							$("#head").toggle();
							lsb.toggle();
							main.css("borderRadius","1em").css("padding","2em");
							var h=elems("div.atitle")+title+"</div>"+
								elems("div.index")+((id/10)?elems("span.ids.n"+id/10)+"</span>":'')+
								elems("span.ids.n"+id%10)+"</span>"+"</div>"+
								elems("div.pubdate")+pubdate+"</div>"+
								elems("div.pubtime")+pubtime+"</div>";
							main.append("<div id='nh' class='articleTitle' "+
								"style='left:0;right:0;position:fixed;margin:auto;height:20%;backgorund:"+
								"linear-gradient(to bottom,#ffe4c4 60%,#ffffff 60%,#ffffff 80%,rgba(255,255,255,0.4) 80%);'>"
								+h+"<a href='#page/1.html'>"+
								"<div id='back' class='back backindex'></div></a></div>")
							main.children().children("a").children("#back").click(function(){
								lsb.animate({left:'0'},100);
								main.css("padding","0");
								getPAGE(1);
								$("#head").toggle(100);
							});
							//console.log(title);
							$("title").text(title+" ---Dora桑的博客");
							main.append("<article style='top:"+Math.round($("#nh").height())+"px;z-index:-1;'>"+article+"</article>");
							var nh=$("#nh");
							nh.css('top','1em').
								css('borderRadius','1em').
								css('width','96%');
							nh.children(".index").css("background",'none').css("top",'-'+main.children("#nh").children(".atitle").css("height"));
							$(".articleTitle .index").each(function(){
								$(this).css("width",$(this).css("height"));
								$(this).css("lineHeight",$(this).css("height"));
							});
						}
						else document.write("你在做什么...这里没有东西哇...");
					});
				}
				function getPAGE(n){
					$("title").text("Dora桑的博客");
					lsb.css("display","block");
					$.get("page.php?page="+n,function(data){
						var dt=eval(data);
						var h="";
						if (1==dt.length) document.write("你在做什么...这里没有东西哇...");
						for(var i=1;i<dt.length;i++){
							h+="<a href='#article/"+dt[i].id+"/"+dt[i].title+".html'>";
							h+=elems("div.articleTitle");
							h+=elems("div.atitle")+dt[i].title+"</div>";
							h+=elems("div.index")+dt[i].id+"</div>";
							h+=elems("div.pubdate")+dt[i].pubdate+"</div>";
							h+=elems("div.pubtime")+dt[i].pubtime+"</div></div></a>";
						}
						if(dt[0]>MAX_ARTICLE_PER_PAGE){
							h+="<div id='selpage'>";
							for(var i=1;i<=dt[0]/10+1;i++){
								h+="<span class='selpg'><a href='#page/"+i+".html'>"+i+"</a></span>";
							}
						}
						main.html(h);
						$(".articleTitle .atitle").each(function(){
							if($(this).text().length>=10){
								$(this).css('fontSize',30/$(this).text().length+'em');
							}
							$(this).css("float",'left');
						});
						$(".articleTitle .index").each(function(){
							$(this).css("width",$(this).css("height"));
							$(this).css("lineHeight",$(this).css("height"));
						});
						$("#selpage .selpg").each(function(i){
							if (i+1!=currentPAGE){
								$(this).click(function(){
									getPAGE(i+1);
									currentPAGE=i+1;
									window.history.pushState({},0,(currentPAGE==1)?("#page/"+currentPAGE+".html"):"");
								});
							}
						});
						$(".articleTitle").each(function(i){
							var mindex=i;
							var t=$(this);
							t.got=0;
							var viewtimess=[],articles=[];
							t.mouseenter(function(){
								var title=t.children(".atitle").text();
								var index=t.children(".index").text();
								var pubdate=t.children(".pubdate").text();
								var pubtime=t.children(".pubtime").text();
								var html="<div id='sidetitle'><h3>"+title+"</h3></div>";
								html+="<div id='sideindex'>文章序号："+index+"</div>";
								html+="<div id='sidepub'>发布于："+toDate(pubdate)+" "+toTime(pubtime)+"</div>";
								var article,viewtimes;
								if(!t.got){
									$.get("page.php?preaid="+t.children(".index").text(),function(data){
										dt=eval(data)[0];
										viewtimess[mindex]=dt.viewtimes;
										articles[mindex]=dt.article;
										t.got=1;
										viewtimes=dt.viewtimes;
										article=dt.article;
										html+="<div id='sideviewtime'>浏览次数："+viewtimes+"</div>";
										html+="<div id='sidearticle'>"+article+"More...</div>";
										lsb.html(html);
										lsb.children("#sidearticle").typewriter(10);
									});
									lsb.html(loading);
								} else {
									viewtimes=viewtimess[mindex];
									article=articles[mindex];
									html+="<div id='sideviewtime'>浏览次数："+viewtimes+"</div>";
									html+="<div id='sidearticle'>"+article+"More...</div>";
									lsb.html(html);
									lsb.children("#sidearticle").typewriter(10);
								}
								t.animate({
									left:'-3em',
									bottom:'0.5em'
								},100);
								t.css("boxShadow",'1em 1em 5px #888888');
							});
							t.mouseleave(function(){
								t.animate({
									left:'0',
									bottom:'0'
								},100);
								t.css("boxShadow",'0.1em 0.1em 5px #888888');
							});
							t.click(function(){
								var nh;
								var h=t.html();
								t.parent().parent().html("<div id='nh' class='articleTitle' "+
									"style='left:0;right:0;margin:auto;height:20%;backgorund:"+
									"linear-gradient(to bottom,#ffe4c4 60%,#ffffff 60%,#ffffff 80%,rgba(255,255,255,0.4) 80%);'>"
									+h+"<a href='#page/"+currentPAGE+".html'><div id='back' class='back backpg'></div></a></div>"+
									"<div id='article' style='margin:1em;'></div><a href='#page/"+currentPAGE+".html'>");
								$("#head").toggle(100,function(){
									lsb.animate({
										left:'-40%'
									},200);
									lsb.hide();
									nh=$("#nh");
									nh.animate({
										top:'1em',
										borderRadius:'1em',
										width:'96%'
									},200);
									nh.children(".index").css("background",'none').css("top",'-'+main.children("#nh").children(".atitle").css("height"));
								});
								main.css("borderRadius","1em").css("padding","2em");
								main.children().children("a").children("#back").click(function(){
									lsb.animate({left:'0'},100);
									main.css("padding","0");
									getPAGE(currentPAGE);
									$("#head").toggle(100);
								});
								$.get("page.php?aid="+t.children(".index").text(),function(data){
									var article=eval(data)[0];
									main.append("<article style='top:"+Math.round($("#nh").height())+"px;'>"+marked(article.article)+"</article>");
								});
								$(".atitle").css("float","none");
							});
						});
					});
				}
				$(".randcolor").each(function(){
					$(this).css("color",rgb());
				});
				$(".changingcolor").each(function(){
					t=$(this);
					setInterval(function(){t.css("color",rgb());},300);
				});
				//setInterval(function(){$("#header").css("border","1px solid "+rgb());},100);
				$("title").text($("#wtitle").text());
				if(cURL.match('article\/[0-9]+')) main.addClass("isArticle");
				if(main.hasClass("isArticle")){
					lsb.css("display","none");
					var currentAID=cURL.match('article\/[0-9]+')[0].replace(/[^0-9]/g,'');
					head.data.isMenu=true;
					changeToArticle(currentAID);
				}else{
					var currentPAGE=(currentPAGE=cURL.match('page\/[0-9]+'))?currentPAGE[0].replace(/[^0-9]/g,''):1;
					head.data.isMenu=true;
					getPAGE(currentPAGE);
				}
				var menu='';
				if([]!=menus){
					for(i in menus){
						menu+='<span class="menu"><a href="'+menus[i][0]+'" style="color:black;">'+menus[i][1]+'</a></span>';
					}
					$("#menus").html(menu);
				}
			});*/
        </script>
        <script>
            const MaxArticlePerPage=10;
            const PHP="./page.php";
            const SITE="//127.0.0.1/Website";
            const DEFAULTTITLE="Dora桑的博客";
            const WELCOME_WORD="Welcome to "+DEFAULTTITLE;
            const MENU=[
                {href:SITE,name:'Home'},
                {href:'./online_chat.php',name:'Online Chat'},
                {href:'./disc.html',name:'About'}
            ];

            var CurrentURL=window.location.toString();
            var PageType=CurrentURL.match('article\/[0-9]+')?"Article":"ArticleMenu";
            var ArticleID=(ArticleID=CurrentURL.match('article\/[0-9]+'))?ArticleID[0].replace(/[^0-9]/g,''):undefined;
            var MenuPage=ArticleID?undefined:(MenuPage=CurrentURL.match('page\/[0-9]+'))?MenuPage[0].replace(/[^0-9]/g,''):1;
            var ArticleTitle=null;
            var Ajax={
                get:function(url,callback){
                    var xmlhttp=new XMLHttpRequest();
                    xmlhttp.open("GET",url,true);
                    xmlhttp.send();
                    xmlhttp.onreadystatechange=function(){
                        if(4===xmlhttp.readyState&&200===xmlhttp.status){
                            var data=xmlhttp.responseText;
                            if(callback&&"function"===typeof(callback)) callback(data);
                        }
                    }
                },
                post:function(url,data,callback){
                    var xmlhttp=new XMLHttpRequest();
                    if (!data) return this.get(url);
                    xmlhttp.open("POST",url,true);
                    xmlhttp.send(data);
                    xmlhttp.onreadystatechange=function(){
                        if(4===xmlhttp.readyState&&200===xmlhttp.status){
                            var data=xmlhttp.responseText;
                            if(callback&&"function"===typeof(callback)) callback(data);
                        }
                    }
                }
            };
            function typewirter(elem,timeout){
                var $ele=elem,str=$ele.innerHTML(),progress=0,str0=str;
                $ele.innerHTML='';
                var t=0;
                var timer=setInterval(function(){
                    var current=str.substr(progress,1);
                    if (current==='<') {
                        progress=str.indexOf('>',progress)+1;
                    }else{
                        progress++;
                    }
                    $ele.html(str.substring(0,progress)+(progress&1?'_':''));
                    if (progress>=str.length){
                        clearInterval(timer);
                    }
                },(timeout?timeout:100));
            };
            var M_ids=[];
            var M_titles=[];
            var M_pubdates=[];
            var M_pubtimes=[];
            var M_viewtimes=[];
            var M_Allpages=NaN;
            window.onscroll=function(){
                if(MenuPage){
                    var l=document.getElementById("leftSideBar");
                    if(window.scrollY>l.offsetTop){
                        l.style.position='fixed';
                        l.style.top=0;
                    }else{
                        l.style.position='relative';
                        l.style.top=null;
                    }
                }
            }
        </script>
	</head>
	<body>
        <div id='head'>
            <template v-if="'ArticleMenu'===PageType">
                <div id='header'>
                    <img src='./logo.png'>
                </div>
                <div id='H_title'>{{DEFAULTTITLE}}</div>
                <div id="menus">
                    <template  v-if="MENU">
                        <span class='M_Menu' v-for="el in MENU"><a :href="el.href">{{el.name}}</a></span>
                    </template>
                    <template v-else>There is no menu</template>
                </div>
            </template>
            <template v-else-if="'Article'===PageType">
                 <div id="A_BackButton"></div>
                 <div id="A_Title">{{CurrentTitle}}</div>
                 <div id="A_ID">{{CurrentID}}</div>
            </template>
        </div>
		<div id='mp'>
			<div id='leftSideBar' v-if="isMenu">
                <template v-if="defaultMessage">{{defaultMessage}}</template>
                <template v-else>
                    <div id='sidetitle'><h3>{{title}}</h3></div>
                    <div id='sideindex'>文章序号：{{index}}</div>
                    <div id='sidepub'>发布于：{{pubtime}}</div>
                    <div id='sideviewtime'>浏览次数：{{viewtime}}</div>
                    <div id='sidearticle'>{{preview}}<br />More...</div>
                </template>
            </div>
			<div id='main' :class="isMenu?'ArticleMenus':'Article'">
                <template v-if="isMenu" v-for="item in MenuData">
                    <a v-if="typeof(item)=='object'" :href="'#article/'+item.id+'/'+item.title+'.html'" @click="setArticle(item.id)">
                        <div class='articleTitle'>
                            <div class='atitle' :style="item.title.length>=10?'font-size:'+30/item.title.length+'em':''">{{item.title}}</div>
                            <div class='index'>{{item.id}}</div>
                        </div>
                    </a>
                </template>
                <template v-else>
                    <article>{{marked(ArticleData)}}</article>
                </template>
                <template v-if="isMenu&&(MenuData[0]>MaxArticlePerPage)">
                    <div id="PageSel">
                        <a v-for="i in Math.floor(MenuData[0]/MaxArticlePerPage)+1" @click="setPage(i)" :href="'#page/'+i"><span class="P_sel">{{i}}</span></a>
                    </div>
                </template>
            </div>
		</div>
		<div id='DownBar' v-if="Copyright">{{Copyright}}</div>
        <script>
            var title=new Vue({
                el:"#title",
                data:{
                    Default:DEFAULTTITLE,
                    PageType:PageType,
                    title:null
                },
                methods:{
                    refresh:function(type){
                        const M=0,A=1;
                        if (M==type) {
                            this.data.title="Page "+MenuPage+" - "+this.data.Default;
                        }else if (A==type) {
                            this.data.title=ArticleTitle+" - "+this.data.Default;
                        }
                    }
                }
            });
            var lsb=new Vue({
                el:"#leftSideBar",
                data:{
                    isMenu:MenuPage,
                    index:NaN,
                    title:null,
                    pubtime:null,
                    viewtime:NaN,
                    preview:null,
                    defaultMessage:WELCOME_WORD
                },
                method:{
                    title:function(newtitle){
                        if (undefined===newtitle) return this.data.title;
                        return this.data.title=newtitle;
                    },
                    pubtime:function(date,time){
                        if (undefined===date) return this.data.pubtime;
                        else if(time){
                            this.data.pubtime=date.substr(0,2)+"nian"+date.substr(2,2)+"yue"+date.substr(4,2)+"ri "+
                                    time.substr(0,2)+":"+time.substr(2,2)+":"+time.substr(4,2);
                        }
                        else {
                            this.data.pubtime=date.substr(0,2)+"nian"+date.substr(2,2)+"yue"+date.substr(4,2)+"ri";
                        }
                    },
                    preview:function(preview){
                        this.data.preview=preview;
                    },
                    viewtime:function(viewtime){
                        this.data.viewtime=viewtime;
                    }
                }
            });
            var main=new Vue({
                el:"#mp",
                data:{
                    isMenu:MenuPage,
                    MenuData:undefined,
                    ArticleMain:undefined,
                    val:null
                },
                methods:{
                    addArticleMenus:function(data){
                        this.MenuData=data;//data;
                    },
                    loading:function(){

                    },
                    setPage:function(page){
                        MenuPage=page;
                        this.loading();
                        Ajax.get(PHP+"?page="+page,getMenu);
                    },
                    setArticle:function (aid) {
                        this.isMenu=undefined;
                        Ajax.get(PHP+"?aid="+aid,function(data){
                            data=eval(data)[0];
                            this.ArticleMain=data.article;
                        });
                    }
                }
            });
            var head=new Vue({
                el:"#head",
                data:{
                    PageType:PageType
                }
            });
            var menus=new Vue({
                el:"#menus",
                data:{
                    menus:MENU
                }
            });
            var downbar=new Vue({
                el:"#DownBar",
                data:{
                    Copyright:undefined
                }
            });
            function getMenu(data){
                data=eval(data);
                M_Allpages=data[0];
                for(var item in data){
                    if("object"===typeof(data[item])){
                        M_ids.push(data[item].id);
                        M_pubdates.push(data[item].pubdate);
                        M_pubtimes.push(data[item].pubtime);
                        M_titles.push(data[item].title);
                    }
                }
                main.addArticleMenus(eval(data));
            }
            document.onreadystatechange=function(){
                if ("complete"==document.readyState) {
                    if(MenuPage){
                        Ajax.get(PHP+"?page="+MenuPage,getMenu);
                    }else if(ArticleID){
                        Ajax.get(PHP+"?aid="+ArticleID,function(data){
                            data=eval(data);
                        });
                    }
                }
            };
        </script>
	</body>
</html>
